<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AI æ··åˆç¾¤èŠ</title>
    <style>
        :root {
            --wechat-green: #95ec69;
            --wechat-bg: #f3f3f3;
            --wechat-header: #ededed;
            --border-color: #ddd;
            --quote-bg: #e1e1e1;
            --text-main: #191919;
            --text-sub: #888;
        }

        /* åŸºç¡€é‡ç½® */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif;
            background-color: var(--wechat-bg);
            overflow: hidden; /* é˜²æ­¢é¡µé¢æ•´ä½“æŠ–åŠ¨ */
        }

        /* ä¸»å®¹å™¨ï¼šå¼ºåˆ¶æ‰‹æœºç«¯å…¨å± */
        #chat-wrapper {
            display: flex; flex-direction: column; 
            height: 100vh; width: 100%;
            background-color: var(--wechat-bg);
        }

        /* é¡¶éƒ¨å¯¼èˆªï¼šè¿˜åŸæˆªå›¾ */
        header {
            background: var(--wechat-header);
            height: 50px; display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; border-bottom: 1px solid var(--border-color);
            flex-shrink: 0; font-size: 16px; font-weight: 500;
        }

        /* æ¶ˆæ¯åˆ—è¡¨ï¼šå¢åŠ æ»šåŠ¨æµç•…åº¦ */
        #message-list {
            flex: 1; overflow-y: auto; padding: 15px;
            display: flex; flex-direction: column; gap: 20px;
            -webkit-overflow-scrolling: touch;
        }

        /* æ¶ˆæ¯æ ·å¼ */
        .msg { display: flex; align-items: flex-start; gap: 10px; max-width: 90%; }
        .avatar {
            width: 42px; height: 42px; border-radius: 4px; flex-shrink: 0;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; font-size: 14px;
        }
        .content-box { display: flex; flex-direction: column; max-width: calc(100% - 52px); }
        .nickname { font-size: 12px; color: #fa9d3b; margin-bottom: 4px; } /* æ¨¡æ‹Ÿæˆªå›¾ä¸­æ©™è‰²æ˜µç§° */
        
        .bubble {
            padding: 10px 12px; border-radius: 6px; position: relative;
            line-height: 1.5; font-size: 15px; background: #fff;
            color: var(--text-main); border: 0.5px solid #e7e7e7;
        }

        /* åª’ä½“æ¶ˆæ¯æ ·å¼ */
        .media-content { max-width: 200px; border-radius: 4px; display: block; }
        .audio-player { width: 180px; height: 35px; }

        /* å¼•ç”¨æ¡† */
        .quote-content {
            background: var(--quote-bg); padding: 8px; border-radius: 4px;
            font-size: 12px; color: #666; margin-top: 4px;
            overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
        }

        /* å·¦å³å¯¹é½ */
        .msg.left { align-self: flex-start; }
        .msg.left .bubble::before {
            content: ""; position: absolute; left: -10px; top: 10px;
            border: 5px solid transparent; border-right-color: #fff;
        }
        .msg.right { align-self: flex-end; flex-direction: row-reverse; }
        .msg.right .nickname { display: none; }
        .msg.right .bubble { background: var(--wechat-green); border: none; }
        .msg.right .bubble::after {
            content: ""; position: absolute; right: -10px; top: 10px;
            border: 5px solid transparent; border-left-color: var(--wechat-green);
        }

        /* åº•éƒ¨å·¥å…·æ ï¼šè¿˜åŸæˆªå›¾å¸ƒå±€ */
        footer {
            background: #f7f7f7; border-top: 1px solid var(--border-color);
            display: flex; flex-direction: column; flex-shrink: 0;
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        #quote-preview {
            background: #eee; padding: 6px 15px; font-size: 12px; color: #666;
            display: none; justify-content: space-between; align-items: center;
        }

        .input-bar {
            display: flex; align-items: center; padding: 8px 10px; gap: 10px;
        }

        .icon-btn { font-size: 24px; color: #333; cursor: pointer; flex-shrink: 0; }
        
        #input-msg {
            flex: 1; border: none; padding: 10px; border-radius: 6px;
            outline: none; font-size: 16px; background: #fff; min-height: 40px;
        }

        #send-btn {
            background: #07c160; color: #fff; border: none; padding: 8px 12px;
            border-radius: 4px; font-size: 14px; display: none;
        }

        .sys-msg { align-self: center; font-size: 12px; color: #b2b2b2; margin: 10px 0; }
    </style>
</head>
<body>

<div id="chat-wrapper">
    <header>
        <span>â€¹ 1</span>
        <span>AIæ—…è¡Œè€… | æ·±åº¦ç¾¤èŠ(179)</span>
        <span>Â·Â·Â·</span>
    </header>
    
    <div id="message-list">
        <div class="sys-msg">13:53</div>
        <div class="msg left" onclick="selectForQuote('DeepSeek', 'å‘ä¸ªè§†é¢‘æˆ–éŸ³é¢‘è¯•è¯•ï¼Ÿ')">
            <div class="avatar" style="background:#4a90e2">D</div>
            <div class="content-box">
                <div class="nickname">DeepSeek @ ä¸Šæµ·ç¨€å®‡</div>
                <div class="bubble">æ¬¢è¿ï¼æˆ‘ç°åœ¨æ”¯æŒåˆ†æå›¾ç‰‡ã€éŸ³é¢‘å’Œè§†é¢‘äº†ã€‚ç‚¹å‡»å³ä¾§çš„ âŠ• å³å¯ä¸Šä¼ ã€‚</div>
            </div>
        </div>
    </div>

    <div id="quote-preview">
        <span id="quote-info"></span>
        <span style="font-size:18px" onclick="cancelQuote()">Ã—</span>
    </div>

    <footer>
        <div class="input-bar">
            <span class="icon-btn">ğŸŒ</span> <input type="text" id="input-msg" placeholder="" autocomplete="off">
            <span class="icon-btn">â˜º</span> <span class="icon-btn" onclick="document.getElementById('file-input').click()">âŠ•</span>
            <button id="send-btn">å‘é€</button>
        </div>
        <input type="file" id="file-input" style="display:none" accept="image/*,video/*,audio/*">
    </footer>
</div>

<script>
    const msgList = document.getElementById('message-list');
    const input = document.getElementById('input-msg');
    const btn = document.getElementById('send-btn');
    const fileInput = document.getElementById('file-input');
    const quoteBar = document.getElementById('quote-preview');
    const quoteInfo = document.getElementById('quote-info');

    let currentQuote = null;

    // è‡ªåŠ¨æ˜¾ç¤º/éšè—å‘é€æŒ‰é’®
    input.addEventListener('input', () => {
        btn.style.display = input.value.trim() ? 'block' : 'none';
        // å¾®ä¿¡é€»è¾‘ï¼šè¾“å…¥æ–‡å­—æ—¶éšè—åŠ å·å›¾æ ‡ï¼ˆæ­¤å¤„ä¸ºç®€åŒ–ï¼Œä¿ç•™åŠ å·ï¼‰
    });

    function selectForQuote(user, text) {
        currentQuote = { user, text };
        quoteBar.style.display = 'flex';
        quoteInfo.innerText = `${user}: ${text.substring(0, 20)}...`;
    }

    function cancelQuote() {
        currentQuote = null;
        quoteBar.style.display = 'none';
    }

    function appendMessage({role, nickname, content, type = 'text', avatar, color, quote}) {
        const msgDiv = document.createElement('div');
        msgDiv.className = `msg ${role}`;
        
        const rawContent = type === 'text' ? content : `[${type}]`;
        msgDiv.onclick = () => selectForQuote(nickname, rawContent);

        let bodyHtml = '';
        if (type === 'text') {
            bodyHtml = `<div class="bubble">${content}</div>`;
        } else if (type === 'image') {
            bodyHtml = `<div class="bubble" style="background:none;border:none;padding:0"><img src="${content}" class="media-content"></div>`;
        } else if (type === 'video') {
            bodyHtml = `<div class="bubble" style="background:none;border:none;padding:0"><video src="${content}" controls class="media-content"></video></div>`;
        } else if (type === 'audio') {
            bodyHtml = `<div class="bubble"><audio src="${content}" controls class="audio-player"></audio></div>`;
        }

        let quoteHtml = quote ? `<div class="quote-content">${quote.user}ï¼š${quote.text}</div>` : '';

        msgDiv.innerHTML = `
            <div class="avatar" style="background:${color}">${avatar}</div>
            <div class="content-box">
                <div class="nickname">${nickname}</div>
                ${bodyHtml}
                ${quoteHtml}
            </div>
        `;
        
        msgList.appendChild(msgDiv);
        setTimeout(() => { msgList.scrollTop = msgList.scrollHeight; }, 100);
    }

    function handleSend() {
        const text = input.value.trim();
        if (!text) return;

        appendMessage({
            role: 'right', nickname: 'æˆ‘', content: text,
            avatar: 'Me', color: '#07c160', quote: currentQuote
        });

        if (text.includes('@æ‰€æœ‰äºº') || text.includes('@DeepSeek')) {
            setTimeout(() => {
                appendMessage({
                    role: 'left', nickname: 'DeepSeek', content: 'æ”¶åˆ°ï¼Œæ­£åœ¨åˆ†ææ‚¨çš„å¤šåª’ä½“è¯·æ±‚...',
                    avatar: 'D', color: '#4a90e2'
                });
            }, 1000);
        }

        input.value = '';
        btn.style.display = 'none';
        cancelQuote();
    }

    fileInput.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        const type = file.type.split('/')[0]; // image, video, or audio

        reader.onload = (ev) => {
            appendMessage({
                role: 'right', nickname: 'æˆ‘', content: ev.target.result, 
                type: type, avatar: 'Me', color: '#07c160'
            });
            
            // æ¨¡æ‹Ÿ AI è¯†åˆ«å„ç§åª’ä½“
            setTimeout(() => {
                let aiText = `å·²æ¥æ”¶å¹¶è¯†åˆ«è¯¥${type}æ–‡ä»¶ã€‚`;
                if(type === 'video') aiText = "è¯¥è§†é¢‘å†…å®¹å·²è§£æï¼Œç”»é¢æµç•…ï¼ŒåŒ…å«å…³é”®å¸§ä¿¡æ¯ã€‚";
                if(type === 'audio') aiText = "éŸ³é¢‘æ³¢å½¢æ­£å¸¸ï¼Œæ­£åœ¨ä¸ºæ‚¨è¿›è¡Œè¯­éŸ³è½¬æ–‡å­—...";
                
                appendMessage({
                    role: 'left', nickname: 'DeepSeek', content: aiText,
                    avatar: 'D', color: '#4a90e2'
                });
            }, 1500);
        };
        reader.readAsDataURL(file);
    };

    btn.onclick = handleSend;
    input.onkeypress = (e) => { if (e.key === 'Enter') handleSend(); };
</script>

</body>
</html>
